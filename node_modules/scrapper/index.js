'use strict';

var osmosis= require('../osmosis');
//on recup le fichier contenant les param de config de recherche
var searchConfig= require('../../searchConfig.json');

var test = function(){
console.log( goCarResponse(searchConfig.annee,searchConfig.kilometrageMax));


}

 var goCarResponse = function (annee, kilometrage){
   var listegocar=[];

     osmosis.get('http://gocar.be/fr/autovlan/voiture-occasion/toutes-marques/tous-modele/page1?country=be&sort=upsellOnTop%3ADESC||days_in_stock%3ADESC&ctype=1&manufacturer=&model=&searchstring=&build=&zip=&radius=500&warranty_program=&mkey=G1-21203-895645&dkey=&_qualityLabel=&km_from=101&km_to='+kilometrage+'&reg_date_from=&reg_date_to='+annee+'&price_from=&price_to=&gas=&kw_from=&kw_to=&_hp_from=&_hp_to=&gears=&doors_grouped=&seats=&euronorm=&age=&private_ad=1&_private_ad=1&color=&accident=')
     .find('.item-vehicle__description a:first-child')
     .follow('@href')
     .set({prix:'body > div.root-a > section > article > div.page_vehicle-details_main_body > div.info > div:nth-child(1) > div.cost > div',
     nom:'.page_vehicle-details_main_head h2',
     couleur:'body > div.root-a > section > div:nth-child(5) > section > article > div:nth-child(1) > ul > li:nth-child(7) > span',
     kilometrage:'body > div.root-a > section > article > div.page_vehicle-details_main_body > div.info > div:nth-child(2) > div.basics > ul > li:nth-child(3) > span:nth-child(2)',
     annee:'body > div.root-a > section > article > div.page_vehicle-details_main_body > div.info > div:nth-child(2) > div.basics > ul > li:nth-child(4) > span:nth-child(2)',
     carburant:'body > div.root-a > section > article > div.page_vehicle-details_main_body > div.info > div:nth-child(2) > div.basics > ul > li:nth-child(1) > span:nth-child(2)',
     categorie:'body > div.root-a > section > div:nth-child(5) > section > article > div:nth-child(1) > ul > li:nth-child(1) > span',
     puissance:'body > div.root-a > section > div:nth-child(5) > section > article > div:nth-child(1) > ul > li:nth-child(2) > span',
     porte:'body > div.root-a > section > div:nth-child(5) > section > article > div:nth-child(1) > ul > li:nth-child(4) > span',
     dateannonce:'body > div.root-a > section > article>div:nth-child(1)',
     phone:'body > div.root-a > section > div:nth-child(5) > section > article > div.box_seller-details > div > div > p.showtel > span > img @data-src',
     ville:'body > div.root-a > section > article > div.page_vehicle-details_main_body > div.info > div:nth-child(2) > div.seller > div > p:nth-child(2) > span:nth-child(2)',
     codepostal:'body > div.root-a > section > article > div.page_vehicle-details_main_body > div.info > div:nth-child(2) > div.seller > div > p:nth-child(2) > span:nth-child(1)',
     equipement:'body > div.root-a > section > div:nth-child(5) > section > article > div:nth-child(2) > ul'})
     .then (function(context,data, next) {
       data.type="";
       for(var j=2; j<data.nom.split(" ").length; j++){
//         data.type=data.type+data.nom.split(" ")[j]+" "
       };
       data.phone ="http://gocar.be"+data.phone;
       //  data.url= document.request.url;
       //   console.log(data.url);
       data.marque=data.nom.split(" ")[1];
       data.url = context.doc().requesthref;
       data.eqx
     //Comme tu peux le voir, si tu enleve le quote, les data sont bien récupére donc ca marche
    //   console.log(data);
       listegocar.push(data);
       next(context, data);


    }).then (function(context,data, next) {

      next(context, data);


   })

    // mais ce putin de done veut pas se declencher qd tt est fini...... et Le 'yo' apprait en tt debut.
    .done(function(){return listegocar})
    .log(console.log)
    .error(console.log)
    .debug(console.log)



 }


 exports.test=test;
